const Escalao1=7091;const Escalao2=10700;const Escalao3=20261;const Escalao4=25000;const Escalao5=36856;const Escalao6=80640;const Escalao1Percent=0.145;const Escalao2Percent=0.23;const Escalao3Percent=0.285;const Escalao4Percent=0.35;const Escalao5Percent=0.37;const Escalao6Percent=0.45;const Escalao7Percent=0.48;const Escalao1MaxImposto=1028.2;const Escalao2MaxImposto=830.07;const Escalao3MaxImposto=2724.89;const Escalao4MaxImposto=1658.65;const Escalao5MaxImposto=4386.72;const Escalao6MaxImposto=19702.8;const ImpostoCapital=0.28;const TaxaSolidariedade1=0.025;const TaxaSolidariedade2=0.05;const LimiteSolidariedade1=80000;const LimiteSolidariedade2=250000;const ImpostoMaxSolidariedade1=4250;const DeducaoRendDependente=4104;const DeducaoRendIndependentePercent=0.75;const LimiteDeducaoRendPensoes=22500;const DeducaoReduzidaRendPensoes=0.8;const DeducaoDependenteMenos3Anos=725;const DeducaoDependenteMais3Anos=600;const DeducaoAscendenteUnico=635;const DeducaoAscendentesMultiplos=525;const QuocienteDependente=0.3;const rendMinimoMensalGarantido2010=475;const indexanteApoioSocial=421.32;const minimoExistencia=indexanteApoioSocial*1.5*14;const limiteRendPropIntelectual=10000;var anoRendimentos;var despesasSaude;var despesasEducacao;var despesasGerais;var despesasIVA;var rendimentoDependente;var rendimentoIndependente;var rendimentoCapital;var rendimentoPredial;var rendimentoPensoes;var rendimentoColectavel;var numContribuintes;var dependentes3Anos;var dependentes;var ascendentes;var estadoCivil;var familiaMonoparental;var perdasCapitais;var condominios;var obras;var impostoMunicipalImoveis;function init(){var a=document.getElementById("taxForm");console.log("init");anoRendimentos=a.anoRendimentos.value;rendimentoDependente=a.rendimentoCatA.value||0;rendimentoIndependente=a.rendimentoCatB.value||0;rendimentoCapital=a.rendimentoCatE.value||0;rendimentoPredial=a.rendimentoCatF.value||0;rendimentoPensoes=a.rendimentoCatG.value||0;dependentes=a.dependentesMais3Anos.value;dependentes3Anos=a.dependentesMenos3Anos.value;ascendentes=a.ascendentes.value;estadoCivil=a.estadoCivil.value;despesasSaude=a.despesasSaude.value;despesasEducacao=a.despesasEducacao.value;despesasIVA=a.despesasIVA.value;despesasGerais=a.despesasGerais.value;condominios=a.despesasCondominios.value;obras=a.despesasConservacao.value;impostoMunicipalImoveis=a.despesasIMI.value;propriedadeIntelectual=a.propriedadeIntelectual.checked;if(estadoCivil=="solteiro"){numContribuintes=1}else{numContribuintes=2}if(numContribuintes==1&&(dependentes>0||dependentes3Anos>0)){familiaMonoparental=true}else{familiaMonoparental=false}console.log(rendimentoDependente);console.log(rendimentoIndependente);console.log(rendimentoCapital);console.log(rendimentoPredial);console.log(rendimentoPensoes);console.log(dependentes3Anos);console.log(dependentes);console.log(ascendentes);console.log(estadoCivil);console.log(despesasSaude);console.log(despesasEducacao);console.log(despesasIVA);console.log(despesasGerais);console.log(propriedadeIntelectual);algoritmo()}function algoritmo(){var c=parseFloat(rendimentoDependente)+parseFloat(rendimentoIndependente)+parseFloat(rendimentoCapital)+parseFloat(rendimentoPredial)+parseFloat(rendimentoPensoes);console.log("Rendimento Total: "+c);var a=calcRendColectavel();console.log("Rendimento Colectavel: "+a);var i=calcTaxaSolidariedadeDevida(a);console.log("Imposto Solidariedade: "+i);var b=calcQuocienteFamiliar();console.log("Quociente Familiar: "+b);var d=a/b;console.log("Rendimento Colectavel Corrigido: "+d);var f;if(anoRendimentos==2017){f=calcImposto17(d)}else{f=calcImposto(d)}console.log("Imposto Apurado: "+f);var j=f*b;console.log("Colecta Total: "+j);var e=j+i;console.log("Colecta Apurada Total: "+e);var g=calcDeducoesTotal(a);console.log("Deducoes a Colecta: "+g);var h=calcColectaLiquida(e,g);console.log("Imposto Final: "+h);if(h<0){h=0}$("#impostoAPagar").val(h.formatMoney(2)+" €");$("#taxaEfectiva").val(((h/c)*100).toFixed(2)+" %");$("#totalLiquido").val((c-h).formatMoney(2)+" €");return h}function calcRendColectavel(){return calcRendColectavelCatA(rendimentoDependente)+calcRendColectavelCatB(rendimentoIndependente)+calcRendColectavelCatE(rendimentoCapital)+calcRendColectavelCatF(rendimentoPredial)+calcRendColectavelCatH(rendimentoPensoes)}function calcRendColectavelCatA(a){if(a<=DeducaoRendDependente){return 0}else{return parseFloat(a)-DeducaoRendDependente}}function calcRendColectavelCatB(c){if(c<=0){return 0}else{a=parseFloat(c);if(propriedadeIntelectual){var a=0;var b=c*0.5;if(b>limiteRendPropIntelectual){b=limiteRendPropIntelectual}a=parseFloat(c)-b}return a*DeducaoRendIndependentePercent}}function calcRendColectavelCatE(b){perdasCapitais=0;if(b<=0){return 0}else{var a=parseFloat(b)-parseFloat(perdasCapitais);if(a<0){return 0}else{return a}}}function calcRendColectavelCatF(b){if(b<=0){return 0}else{var a=b-condominios-obras-impostoMunicipalImoveis;if(a<=0){return 0}else{return a}}}function calcRendColectavelCatH(b){var a;if(b<=LimiteDeducaoRendPensoes){a=b-DeducaoRendDependente;if(a<=0){return 0}else{return a}}else{var c=DeducaoRendDependente-((b-LimiteDeducaoRendPensoes)*0.2);if(c<0){c=0}a=b-c;if(a<=0){return 0}else{return a}}}function calcTaxaSolidariedadeDevida(b){var a;if(b>LimiteSolidariedade1&&b<=LimiteSolidariedade2){console.log("Taxa de Solidariedade 1");a=(b-LimiteSolidariedade1)*TaxaSolidariedade1;console.log(a);return a}else{if(b>LimiteSolidariedade2){console.log("Taxa de Solidariedade 2");a=((b-LimiteSolidariedade2)*TaxaSolidariedade2)+ImpostoMaxSolidariedade1;console.log(a);return a}else{return 0}}}function calcQuocienteFamiliar(){return numContribuintes}function calcImposto(b){var a;if(b<=0){console.log("Nao paga imposto");return 0}if(b<=Escalao1){console.log("escalao1");a=(b*Escalao1Percent);console.log(a);return a}else{if(b>Escalao1&&b<=Escalao2){console.log("escalao2");a=(((b-Escalao1)*Escalao2Percent)+Escalao1MaxImposto);console.log(a);return a}else{if(b>Escalao2&&b<=Escalao3){console.log("escalao3");a=(((b-Escalao2)*Escalao3Percent)+Escalao1MaxImposto+Escalao2MaxImposto);return a}else{if(b>Escalao3&&b<=Escalao4){console.log("escalao4");a=(((b-Escalao3)*Escalao4Percent)+Escalao1MaxImposto+Escalao2MaxImposto+Escalao3MaxImposto);return a}else{if(b>Escalao4&&b<=Escalao5){console.log("escalao5");a=(((b-Escalao4)*Escalao5Percent)+Escalao1MaxImposto+Escalao2MaxImposto+Escalao3MaxImposto+Escalao4MaxImposto);return a}else{if(b>Escalao5&&b<=Escalao6){console.log("escalao6");a=(((b-Escalao5)*Escalao6Percent)+Escalao1MaxImposto+Escalao2MaxImposto+Escalao3MaxImposto+Escalao4MaxImposto+Escalao5MaxImposto);return a}else{if(b>Escalao6){console.log("escalao7");a=(((b-Escalao6)*Escalao7Percent)+Escalao1MaxImposto+Escalao2MaxImposto+Escalao3MaxImposto+Escalao4MaxImposto+Escalao5MaxImposto+Escalao6MaxImposto);return a}}}}}}}}function calcDeducoesTotal(b){var c=calcDespesasSaude(despesasSaude);var e=calcDespesasEducacao(despesasEducacao);var g=calcDespesasIVA(despesasIVA);var d=calcDespesasGerais(despesasGerais);var f=calcDeducoesDependentes();var h=calcDeducoesAscendentes();var i=calcLimiteDeducoes(b);var a=c+e+g;if(a>i&&i>0){a=i}return d+f+h+a}function calcDespesasSaude(c){var d=0.15;var b=1000;var a=c*d;if(a<b){return a}else{return b}}function calcDespesasEducacao(d){var c=0.3;var b=800;var a=d*c;if(a<b){return a}else{return b}}function calcDespesasGerais(b){var d=0.35;var c=0.45;var e=250;var f=335;var a;if(familiaMonoparental){a=b*c;if(a<f){return a}else{return f}}else{a=b*d;if(a<(e*numContribuintes)){return a}else{return e*numContribuintes}}}function calcDespesasIVA(c){var d=0.15;var b=250;var a=c*d;if(a<b){return a}else{return b}}function calcDeducoesDependentes(){var b=dependentes3Anos*DeducaoDependenteMenos3Anos;var a=dependentes*DeducaoDependenteMais3Anos;return b+a}function calcDeducoesAscendentes(){if(ascendentes>1){return DeducaoAscendentesMultiplos*ascendentes}else{return DeducaoAscendenteUnico*ascendentes}}function calcLimiteDeducoes(b){var a=-1;if(b<=Escalao1){return a}else{if(b>Escalao1&&b<=Escalao6){a=1000+(1500*(Escalao6-b))/(Escalao6-Escalao1)}else{a=1000}}if(dependentes>=3){a+=a*(0.05*dependentes)}return a}function calcColectaLiquida(b,a){return b-a}$("#rendimentoCatB").change(function(){var a=$("#rendimentoCatB").val()<=0;$(".despesasCatB").toggle(!a)});$("#rendimentoCatF").change(function(){var a=$("#rendimentoCatF").val()<=0;$(".despesasCatF").toggle(!a)});